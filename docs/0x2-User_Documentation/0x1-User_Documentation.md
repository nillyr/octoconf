# User documentation

## Installation

Two installation methods of the tool are available.

From the "compiled" version:

```bash
# Get the latest version of the tool at https://github.com/nillyr/octoconf/releases
python3 -m venv octoconf
# Activate the venv
# Install wheel
python -m pip install octoconf-<version>.whl
# or
python -m pip install octoconf-<version>.tar.gz
```

Directly from the sources:

```bash
# If and only if submodules are set to public, clone the repo with submodules
git clone --recurse-submodules https://github.com/nillyr/octoconf.git
# Else
git clone https://github.com/nillyr/octoconf.git
cd octoconf
# Install on Linux/Unix
bash ./setup.sh
# Install on Windows
.\setup.bat
```

## Compilation

```bash
cd octoconf
make
```

## Features

### Script generation

Allows to generate from a checklist passed in argument a collection script in the chosen language (see the list of supported languages in the help output). It is also possible to generate collection scripts for devices such as routers, switches, etc. The Epilog and Prolog parts of the script may need to be modified.

#### Command examples: Script generation

```bash
# Linux
octoconf checklist generate -c ./ubuntu20-04.yaml -l bash -p linux -o ubuntu20-04.sh
# UNIX macOS
octoconf checklist generate -c ./macOS11.yaml -l bash -p mac -o macOS11.sh
# Windows (Batch)
octoconf checklist generate -c ./windows10-desktop.yaml -l batch -p windows -o windows10.bat
# Windows (Powershell)
octoconf checklist generate -c ./windows10-desktop.yaml -l powershell -p windows -o windows10.ps1
```

### Analyze

Allows an analysis of the results of the checks based on a checklist.

**Important:** the archive must have been generated by the collection script derived from the checklist used for the analysis.

#### Command examples: Analyze

```bash
# (tag.gz format) Launch the analyze
octoconf analyze -a archive.tar.gz -c ./your-checklist.yaml
# (tag.gz format) Launch the analyze and specify the language to use in the output file (xlsx)
octoconf analyze -a archive.tar.gz -c ./your-checklist.yaml -l en
# (zip format) Launch the analyze
octoconf analyze -a archive.zip -c ./your-checklist.yaml
# (zip format) Launch the analyze and specify the language to use in the output file (xlsx)
octoconf analyze -a archive.zip -c ./your-checklist.yaml -l en
```

### Audit

Allows to execute all the specified commands from a checklist. The results of the `collection_cmd` will be present in output files. The output path is automatically determined by taking into account the name of the category and the file specified in the command.

After the execution of the commands, the results are verified taking into account the verification type requested.

Finally, an XLSX file is generated presenting the results graphically. JSON and XLM files are also generated for later use.

#### Command examples: Audit

```bash
# Launch the audit
octoconf audit -c ./your-checklist.yaml -o ouput_dir/
# Launch the audit and specify the language to use in the output file (xlsx)
octoconf audit -c ./your-checklist.yaml -o ouput_dir/ -l en
```

### Report generation

This use case can be called automatically as a chain of other use cases or independently. When called independently, this use case takes as input a JSON file (the one produced by the other use cases) in order to (re)generate a file in XLSX format.

#### Command examples: Report generation

```bash
# Launch the report generation
octoconf report -i 20211006115003_results.json
# Launch the report generation and specify the language to use in the output file
octoconf report -i 20211006115003_results.json -l en
```

## Creating your checklists

The format chosen for the checklists is `yaml`.

### Checklist template

The basic template is as follows:

```yaml
# id must be int and unique
- id: 1
  name: A category name
  checkpoints:
  # id must be int and unique
  - id: 1
    # The title will be used in the generated files
    title: A checkpoint title
    description: >
      A multiline description
      The text contained between the ignore_tags parameter
      (x: <x> and </x>) will not be translated
    # Optionnal value
    # Performing a full extraction is highly recommended for
    # collecting audit proof.
    # Accepted redirect:
    #   - >
    #   - >>
    #   - | Out-File -Encoding utf8 -FilePath
    #   - | Out-File -Encoding utf8 -Append -FilePath
    #   - /H (gpresult.exe) or /cfg (SecEdit.exe)
    collection_cmd: command > output_file.txt
    # Optionnal value (must be present if collection_cmd is defined)
    #   - AUDIT_POWERSHELL = powershell.exe
    #   - BATCH_EXEC = cmd.exe
    #   - CMD_EXEC = /bin/bash
    collection_cmd_type: CMD_EXEC
    # Possible values: true | false
    #   - true: checks can be remove
    #   - false: checks must be defined
    collect_only: false
    checks:
    # id must be int and unique
    - id: 1
      title: a random title
      description: >
        a <x>random</x> description
      # Optionnal value. String. Rule ID (eg. SV-238204r653787_rule)/Your reference
      reference: your-reference
      type: CMD_EXEC
      # No output file here (it is done dynamically)
      cmd: whoami
      expected: .*
      # Type of verification to be performed
      # Possible values:
      #   - CHECK_EXACT   expects a simple value
      #   - CHECK_REGEX   expects a python regular expression
      verification_type: CHECK_REGEX
      # Possible values:
      #   - high
      #   - medium
      #   - low
      #   - info
      severity: high
      recommendation_on_failed: a <x>reco</x> here
      # Optional value. String
      see_also: https://www.your-reference.com/
```

### Usage exemple with your checklist

```bash
octoconf checklist generate -c <path/to/my/checklist.yaml> -l <lang> -p <platform> -o <script.extension>
```

## Existing checklists

The tool uses the [octochecklists](https://github.com/nillyr/octochecklists) submodule which _can_ contain publicly available checklists.

When checklists are made public and are contained in the tool, it is then possible to list them:

```bash
# No filter
octoconf checklist list
# Filter on desktop category
octoconf checklist list -c desktop
```

Otherwise, an empty output will be displayed.

## Checklists translation

This tool uses the free deepl api to perform the translation of the checklists.

In order to use this feature, it is necessary to create an account on the application DeepL in order to obtain an "Authentication Key for DeepL API".

Then, it is necessary to create a `.env` file at the root of the project and to add the API key for the `DEEPL_API_KEY` environment variable.
